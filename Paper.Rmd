---
title: "Simulating NFL Playoff Chances"
author: "Noah Sturgeon, Chase Bishop, Carter Nault"
output:
  pdf_document: default
  html_document: default
---
```{r elo_start}
library(tidyverse)

standings_odds <- read_csv("2024_standings_2025_odds(in).csv")

hfa_data <- read_csv("NFL-HomeFieldAdvantage-Data.csv")

weights <- c(0.4, 0.6)
mean_elo <- 1000
scale <- 50

team_data <- standings_odds |>
  arrange(Tm) |>
  rename(Team_Name = Tm) |>
  mutate(Weighted_ProjW = weights[1] * W + weights[2] * ProjW) |>
  mutate(Elo = (Weighted_ProjW - 8.5) * scale + mean_elo) |>
  mutate(HFA = hfa_data$Total)
```

```{r win_probability_calculator}
get_opposite_index_of_value <- function(input_vector, target_index) {
  result <- which(input_vector == input_vector[target_index])
  return(result[result != target_index])
}

calculate_win_probabilities <- function(team_names, home_teams, elo, hfa, S) {
  win_probabilities <- rep(0, length(team_names))
  for(team in 1:length(team_names)) {
    if(team_names[team] == home_teams[team]) {
      away_team_index <- get_opposite_index_of_value(home_teams, team)
      exponent <- (-1*(elo[team] + hfa[team] - elo[away_team_index]))/S
      win_probabilities[team] <- 1/(1+10^exponent)
      win_probabilities[away_team_index] <- 1-win_probabilities[team]
    }
  }
  return(win_probabilities)
}

test_team_data <- team_data[1:2,] 
test_team_data |> 
  mutate(Schedule = rep("Atlanta Falcons",2)) |> 
  mutate(win_prob = calculate_win_probabilities(Team_Name, Schedule, Elo, HFA, 400))
```

```{r game_simulator}
week_simulator <- function(team_names, home_teams, win_probabilities) {
  game_results <- rep(-1,length(team_names))
  for(team in 1:length(team_names)) {
    if(team_names[team] == home_teams[team]) {
      u <- runif(1, min = 0, max = 1)
      away_team_index <- get_opposite_index_of_value(home_teams, team)
      if(u < win_probabilities[team]) {
        game_results[team] <- 1
        game_results[away_team_index] <- 0
      } else {
        game_results[team] <- 0
        game_results[away_team_index] <- 1
      }
    }
  }
  return(game_results)
}

test_team_data |> mutate(week_results)
```